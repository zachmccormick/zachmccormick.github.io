<!DOCTYPE html>
<html lang="en">
<head>
        <title>Thoughts and Discoveries of Zach McCormick - geography</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
        <link href="../" type="application/atom+xml" rel="alternate" title="Thoughts and Discoveries of Zach McCormick ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body>
	<div id="wrap" style="width:850px">
	    <div id="container" style="width:560px">


            <div class="entry">
        
        

            <header>
            <h1><a href=".." id="site-title">  </a>  <a href="../posts/2017/08/running-geodjango-on-heroku-august-2017/" id="page-title">Running GeoDjango on Heroku (August 2017)</a></h1>
<time datetime="2017-08-16T12:00:00-04:00">Wed 16 August 2017</time>            </header>

            <article>
                <h3 id="heroku-setup">Heroku Setup</h3>
<p>There are currently two ways to get the GDAL, GEOS, and PROJ libraries needed by
GeoDjango onto your Heroku slug</p>
<ol>
<li>Via a custom buildpack
(<a href="https://github.com/cyberdelia/heroku-geo-buildpack">https://github.com/cyberdelia/heroku-geo-buildpack</a>)</li>
<li>Via setting the environment variable BUILD_WITH_GEO_LIBRARIES=1 while using the
default Python buildpack</li>
</ol>
<p>This has two issues as of 8–16–2017: The current “stack” on Heroku is heroku-16.
This stack does not properly copy over libjasper, which is a required linked
library by libgdal. One solution is to set your stack to cedar-14 instead.
Another solution is to use a slightly modified custom buildpack
(<a href="https://github.com/dschep/heroku-geo-buildpack">https://github.com/dschep/heroku-geo-buildpack</a>)
or a slightly modified offical buildpack
(<a href="https://github.com/TrailblazingTech/heroku-buildpack-python#fix-gdal-jasper">https://github.com/TrailblazingTech/heroku-buildpack-python#fix-gdal-jasper</a>).</p>
<p>If you stick with the heroku-16 stack, you’ll want to add the following to your
settings.py:</p>
<blockquote>
<p>GDAL_LIBRARY_PATH = os.getenv(‘GDAL_LIBRARY_PATH’)<br> GEOS_LIBRARY_PATH =
os.getenv(‘GEOS_LIBRARY_PATH’)</p>
</blockquote>
<p>Then, if using the official Python buildpack, you will want to set your
environment variables like so:</p>
<blockquote>
<p>GDAL_LIBRARY_PATH=/app/.heroku/vendor/lib/libgdal.so<br>
GEOS_LIBRARY_PATH=/app/.heroku/vendor/lib/libgeos_c.so</p>
</blockquote>
<p>This may be required as well on cedar-14 — I didn’t take notes during that part
of the struggle :-)</p>
<h3 id="django-settings-changes">Django Settings Changes</h3>
<ol>
<li>Add ‘django.contrib.gis’ to your INSTALLED_APPS</li>
<li>Change your DATABASES dict to use postgis, like so:</li>
</ol>
<blockquote>
<p>DATABASES[‘default’] = dj_database_url.config(conn_max_age=600,<br> 
default=’postgis://localhost:5432/{}’.format(APP_NAME))<br>  # VERY IMPORTANT
BECAUSE HEROKU WILL USE ‘postgres’ AS THE SCHEME<br> 
DATABASES[‘default’][‘ENGINE’] = ‘django.contrib.gis.db.backends.postgis’</p>
</blockquote>
<h3 id="other-django-things">Other Django Things</h3>
<p>In urls.py, change <strong>from django.contrib import admin</strong> to <strong>from
django.contrib.gis import admin</strong> for admin urls</p>
<ol>
<li>In whatever app makes sense, add the following migration:</li>
</ol>
<blockquote>
<p>from django.contrib.postgres.operations import CreateExtension<br> from
django.db import migrations</p>
<p>class Migration(migrations.Migration):<br>  operations = [<br> 
CreateExtension(‘postgis’)<br>  ]</p>
</blockquote>
<h3 id="credits">Credits</h3>
<p><a href="http://twitter.com/cyberdelia">cyberdelia</a> and
<a href="http://twitter.com/dschep">dschep</a> on GitHub for helping provide and work
through the gdal dependency issues with a custom buildpack.</p>
<h3 id="github-example">GitHub Example</h3>
<p><a href="https://github.com/TrailblazingTech/django-gis-heroku">https://github.com/TrailblazingTech/django-gis-heroku</a></p>            </article>
            </div>
        </div>


        <div id="sidebar">
            <h1><a href=".. " title="title">Thoughts and Discoveries of Zach McCormick</a></h1>
            <span class="description">My blog and stuff ... </span>
            <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
        </div>

        <div id="footer">
            <nav>
                <ul>
                    <li>:: <a href="../tags.html">Tags</a></li>
                </ul>
            </nav>

            <div id="credits">
                <span>Adapted from <a href="http://wordpress.org/themes/monospace">Monospace</a> || Created with <a href="">Pelican</a></span>
            </div>
                
        </div>


    </div>

</body>
</html>